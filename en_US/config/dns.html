<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>DNS Server | V2Fly.org</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="apple-touch-icon" size="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" size="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" size="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" color="#5bbad5" href="/safari-pinned-tab.svg">
    <meta name="description" content="Project V is a collection of tools that can help you build your own basic communication network">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="apple-mobile-web-app-title" content="Project V">
    <meta name="application-name" content="Project V">
    <meta name="msapplication-TileColor" content="#da532c">
    
    <link rel="preload" href="/assets/css/0.styles.d72e43c9.css" as="style"><link rel="preload" href="/assets/js/app.53fc3f09.js" as="script"><link rel="preload" href="/assets/js/3.21417aa6.js" as="script"><link rel="preload" href="/assets/js/6.86334a57.js" as="script"><link rel="preload" href="/assets/js/56.e7d5cf5c.js" as="script"><link rel="prefetch" href="/assets/js/10.c245746a.js"><link rel="prefetch" href="/assets/js/100.d1fbeebd.js"><link rel="prefetch" href="/assets/js/101.b6218476.js"><link rel="prefetch" href="/assets/js/102.efef1981.js"><link rel="prefetch" href="/assets/js/103.720e60ae.js"><link rel="prefetch" href="/assets/js/104.37d26b43.js"><link rel="prefetch" href="/assets/js/105.06584deb.js"><link rel="prefetch" href="/assets/js/106.22b10e3e.js"><link rel="prefetch" href="/assets/js/107.75e695d8.js"><link rel="prefetch" href="/assets/js/108.b4375a13.js"><link rel="prefetch" href="/assets/js/109.450370f9.js"><link rel="prefetch" href="/assets/js/11.d5945671.js"><link rel="prefetch" href="/assets/js/110.52b6fc46.js"><link rel="prefetch" href="/assets/js/111.3ecee5e7.js"><link rel="prefetch" href="/assets/js/112.6954c519.js"><link rel="prefetch" href="/assets/js/113.ee3310f6.js"><link rel="prefetch" href="/assets/js/114.2436cea2.js"><link rel="prefetch" href="/assets/js/115.12762f94.js"><link rel="prefetch" href="/assets/js/116.94d8e3c0.js"><link rel="prefetch" href="/assets/js/117.6a669045.js"><link rel="prefetch" href="/assets/js/118.e2f52a24.js"><link rel="prefetch" href="/assets/js/119.3b411862.js"><link rel="prefetch" href="/assets/js/12.069c41f7.js"><link rel="prefetch" href="/assets/js/120.b0682ebd.js"><link rel="prefetch" href="/assets/js/121.1025dcc3.js"><link rel="prefetch" href="/assets/js/122.f1f77b46.js"><link rel="prefetch" href="/assets/js/123.30dc1299.js"><link rel="prefetch" href="/assets/js/124.e3f55df2.js"><link rel="prefetch" href="/assets/js/125.6efc8140.js"><link rel="prefetch" href="/assets/js/126.46ecc00a.js"><link rel="prefetch" href="/assets/js/127.efacd619.js"><link rel="prefetch" href="/assets/js/128.8c566e80.js"><link rel="prefetch" href="/assets/js/129.18dfa3e8.js"><link rel="prefetch" href="/assets/js/13.6d34fbab.js"><link rel="prefetch" href="/assets/js/130.4d1cec14.js"><link rel="prefetch" href="/assets/js/131.a9b19991.js"><link rel="prefetch" href="/assets/js/132.027105c0.js"><link rel="prefetch" href="/assets/js/133.eb08fbcb.js"><link rel="prefetch" href="/assets/js/134.09abe6f5.js"><link rel="prefetch" href="/assets/js/135.e81f9be2.js"><link rel="prefetch" href="/assets/js/136.e68f7d22.js"><link rel="prefetch" href="/assets/js/137.f5f68145.js"><link rel="prefetch" href="/assets/js/138.f411c1ca.js"><link rel="prefetch" href="/assets/js/139.6923641c.js"><link rel="prefetch" href="/assets/js/14.56741a34.js"><link rel="prefetch" href="/assets/js/140.814a608b.js"><link rel="prefetch" href="/assets/js/141.c7e4ede1.js"><link rel="prefetch" href="/assets/js/142.e19307ae.js"><link rel="prefetch" href="/assets/js/143.b4c11bda.js"><link rel="prefetch" href="/assets/js/144.3adbbca4.js"><link rel="prefetch" href="/assets/js/145.878d4e5e.js"><link rel="prefetch" href="/assets/js/146.4bebab93.js"><link rel="prefetch" href="/assets/js/147.cebba3d7.js"><link rel="prefetch" href="/assets/js/148.d8661708.js"><link rel="prefetch" href="/assets/js/149.d15ad818.js"><link rel="prefetch" href="/assets/js/15.f3f9023a.js"><link rel="prefetch" href="/assets/js/150.f1723239.js"><link rel="prefetch" href="/assets/js/151.88e8d251.js"><link rel="prefetch" href="/assets/js/152.827a59d5.js"><link rel="prefetch" href="/assets/js/16.4b84dd8b.js"><link rel="prefetch" href="/assets/js/17.4f499a1b.js"><link rel="prefetch" href="/assets/js/18.e562efea.js"><link rel="prefetch" href="/assets/js/19.306be50e.js"><link rel="prefetch" href="/assets/js/20.acd9aae4.js"><link rel="prefetch" href="/assets/js/21.d69813d7.js"><link rel="prefetch" href="/assets/js/22.00632b2a.js"><link rel="prefetch" href="/assets/js/23.dec43b71.js"><link rel="prefetch" href="/assets/js/24.01a5da5b.js"><link rel="prefetch" href="/assets/js/25.99c8b32b.js"><link rel="prefetch" href="/assets/js/26.60d231d2.js"><link rel="prefetch" href="/assets/js/27.be97cda3.js"><link rel="prefetch" href="/assets/js/28.87a56723.js"><link rel="prefetch" href="/assets/js/29.7de98d2c.js"><link rel="prefetch" href="/assets/js/30.67ed537c.js"><link rel="prefetch" href="/assets/js/31.b138684e.js"><link rel="prefetch" href="/assets/js/32.c16f2498.js"><link rel="prefetch" href="/assets/js/33.5ddf7ea4.js"><link rel="prefetch" href="/assets/js/34.89843167.js"><link rel="prefetch" href="/assets/js/35.6f89e906.js"><link rel="prefetch" href="/assets/js/36.46aba1da.js"><link rel="prefetch" href="/assets/js/37.523292ea.js"><link rel="prefetch" href="/assets/js/38.f77d4d36.js"><link rel="prefetch" href="/assets/js/39.a71671de.js"><link rel="prefetch" href="/assets/js/4.aba52a62.js"><link rel="prefetch" href="/assets/js/40.1028c09a.js"><link rel="prefetch" href="/assets/js/41.2f84d1d5.js"><link rel="prefetch" href="/assets/js/42.09c81d6a.js"><link rel="prefetch" href="/assets/js/43.7a276e04.js"><link rel="prefetch" href="/assets/js/44.70b60578.js"><link rel="prefetch" href="/assets/js/45.0cadaa57.js"><link rel="prefetch" href="/assets/js/46.8e109daf.js"><link rel="prefetch" href="/assets/js/47.40f9b220.js"><link rel="prefetch" href="/assets/js/48.bd27cf1c.js"><link rel="prefetch" href="/assets/js/49.3bc6bb6b.js"><link rel="prefetch" href="/assets/js/5.d1f468ef.js"><link rel="prefetch" href="/assets/js/50.4d4a37be.js"><link rel="prefetch" href="/assets/js/51.725ce8fa.js"><link rel="prefetch" href="/assets/js/52.5f7bf18d.js"><link rel="prefetch" href="/assets/js/53.ce1ea547.js"><link rel="prefetch" href="/assets/js/54.f0e44880.js"><link rel="prefetch" href="/assets/js/55.5da6a71e.js"><link rel="prefetch" href="/assets/js/57.bf5aa05e.js"><link rel="prefetch" href="/assets/js/58.325d364a.js"><link rel="prefetch" href="/assets/js/59.7dd25d4e.js"><link rel="prefetch" href="/assets/js/60.f2e4d840.js"><link rel="prefetch" href="/assets/js/61.f86c429d.js"><link rel="prefetch" href="/assets/js/62.777e660c.js"><link rel="prefetch" href="/assets/js/63.0243ed21.js"><link rel="prefetch" href="/assets/js/64.0cd073d9.js"><link rel="prefetch" href="/assets/js/65.c05f6977.js"><link rel="prefetch" href="/assets/js/66.e8b052c5.js"><link rel="prefetch" href="/assets/js/67.d1c53c71.js"><link rel="prefetch" href="/assets/js/68.8498eab8.js"><link rel="prefetch" href="/assets/js/69.67cb1d0b.js"><link rel="prefetch" href="/assets/js/7.442c5769.js"><link rel="prefetch" href="/assets/js/70.4944b7db.js"><link rel="prefetch" href="/assets/js/71.92fbd46f.js"><link rel="prefetch" href="/assets/js/72.a194bc37.js"><link rel="prefetch" href="/assets/js/73.5bebdec3.js"><link rel="prefetch" href="/assets/js/74.51249197.js"><link rel="prefetch" href="/assets/js/75.cddb6497.js"><link rel="prefetch" href="/assets/js/76.7cafae4d.js"><link rel="prefetch" href="/assets/js/77.29dd33e6.js"><link rel="prefetch" href="/assets/js/78.e0131526.js"><link rel="prefetch" href="/assets/js/79.ba496ef2.js"><link rel="prefetch" href="/assets/js/8.8f12d198.js"><link rel="prefetch" href="/assets/js/80.ef24720a.js"><link rel="prefetch" href="/assets/js/81.2c6abbcc.js"><link rel="prefetch" href="/assets/js/82.e1473104.js"><link rel="prefetch" href="/assets/js/83.b853ae0e.js"><link rel="prefetch" href="/assets/js/84.1accaa38.js"><link rel="prefetch" href="/assets/js/85.2de438ff.js"><link rel="prefetch" href="/assets/js/86.feb51964.js"><link rel="prefetch" href="/assets/js/87.974bbb17.js"><link rel="prefetch" href="/assets/js/88.4be8ffb5.js"><link rel="prefetch" href="/assets/js/89.944f4b16.js"><link rel="prefetch" href="/assets/js/9.625e2be0.js"><link rel="prefetch" href="/assets/js/90.4419fad4.js"><link rel="prefetch" href="/assets/js/91.e39d3a4d.js"><link rel="prefetch" href="/assets/js/92.1caa6052.js"><link rel="prefetch" href="/assets/js/93.22f673de.js"><link rel="prefetch" href="/assets/js/94.c54cf259.js"><link rel="prefetch" href="/assets/js/95.d102ff18.js"><link rel="prefetch" href="/assets/js/96.edbabfe0.js"><link rel="prefetch" href="/assets/js/97.322a2065.js"><link rel="prefetch" href="/assets/js/98.24cd8fad.js"><link rel="prefetch" href="/assets/js/99.62bd8de7.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.fd6baf40.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d72e43c9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/en_US/" class="home-link router-link-active"><img src="/v2ray.png" alt="V2Fly.org" class="logo"> <span class="site-name can-hide">V2Fly.org</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/en_US/guide/start.html" class="nav-link">
  Quick Start
</a></div><div class="nav-item"><a href="/en_US/config/overview.html" class="nav-link">
  Config Reference
</a></div><div class="nav-item"><a href="/en_US/awesome/tools.html" class="nav-link">
  Tools
</a></div><div class="nav-item"><a href="/en_US/developer/intro/compile.html" class="nav-link">
  Developer Guide
</a></div><div class="nav-item"><a href="https://guide.v2fly.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  New concise guide
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="选择语言" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="选择语言" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/config/dns.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/en_US/config/dns.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li></ul></div></div> <a href="https://github.com/v2fly" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/en_US/guide/start.html" class="nav-link">
  Quick Start
</a></div><div class="nav-item"><a href="/en_US/config/overview.html" class="nav-link">
  Config Reference
</a></div><div class="nav-item"><a href="/en_US/awesome/tools.html" class="nav-link">
  Tools
</a></div><div class="nav-item"><a href="/en_US/developer/intro/compile.html" class="nav-link">
  Developer Guide
</a></div><div class="nav-item"><a href="https://guide.v2fly.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  New concise guide
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="选择语言" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="选择语言" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/config/dns.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/en_US/config/dns.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li></ul></div></div> <a href="https://github.com/v2fly" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Config Reference</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/en_US/config/overview.html" class="sidebar-link">Configuration File Format</a></li><li><a href="/en_US/config/dns.html" aria-current="page" class="active sidebar-link">DNS Server</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/en_US/config/dns.html#supported-dns-protocols-and-routing-strategies" class="sidebar-link">Supported DNS protocols and routing strategies</a></li><li class="sidebar-sub-header"><a href="/en_US/config/dns.html#dns-processing-flow" class="sidebar-link">DNS Processing Flow</a></li><li class="sidebar-sub-header"><a href="/en_US/config/dns.html#dnsobject" class="sidebar-link">DnsObject</a></li><li class="sidebar-sub-header"><a href="/en_US/config/dns.html#serverobject" class="sidebar-link">ServerObject</a></li></ul></li><li><a href="/en_US/config/outbounds.html" class="sidebar-link">Outbounds</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Protocols</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/en_US/config/protocols/blackhole.html" class="sidebar-link">Blackhole</a></li><li><a href="/en_US/config/protocols/dns.html" class="sidebar-link">DNS</a></li><li><a href="/en_US/config/protocols/dokodemo.html" class="sidebar-link">Dokodemo-door</a></li><li><a href="/en_US/config/protocols/freedom.html" class="sidebar-link">Freedom</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Transport</span> <!----></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="dns-server"><a href="#dns-server" class="header-anchor">#</a> DNS Server</h1> <p>V2Ray has a built-in DNS server, which has two main purposes: matching routing rules according to the IP resolved from a domain, and traditional DNS function—resolving the target address to connect.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Due to the complexity of DNS protocol, V2Ray only supports basic IP query function (A and AAAA records). In order to have a complete DNS experience, you may want to use a dedicated local DNS server, such as <a href="https://coredns.io" target="_blank" rel="noopener noreferrer">CoreDNS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, together with V2Ray's builtin DNS features.</p></div> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>For <code>outbound</code>s using the <code>freedom</code> protocol, the default value of <code>domainStrategy</code> is <code>AsIs</code>, therefore the DNS settings will not be applied to this outbound by default. If necessary, it should be configured as <code>UseIP</code>.</p></div> <h2 id="supported-dns-protocols-and-routing-strategies"><a href="#supported-dns-protocols-and-routing-strategies" class="header-anchor">#</a> Supported DNS protocols and routing strategies</h2> <ul><li>DNS over <strong>UDP</strong>: The query is routed to a configuration-specified outbound
<ul><li>In the form of an IP address, such as <code>8.8.8.8</code></li> <li>The query is made on port <code>53</code> by default, but non-standard ports are supported</li></ul></li> <li>DNS over <strong>TCP</strong>: The query is routed to a configuration-specified outbound
<ul><li>In the form of <code>tcp://host:port</code>, such as <code>tcp://8.8.8.8:53</code></li> <li>The query is made on port <code>53</code> by default, but non-standard ports are supported</li> <li>Available since v4.40.0</li></ul></li> <li>DNS over <strong>TCP local mode</strong>: The query is not rerouted, but instead directly forwarded through a <code>freedom</code> outbound
<ul><li>In the form of <code>tcp+local://host:port</code>, such as <code>tcp+local://8.8.8.8:53</code></li> <li>The query is made on port <code>53</code> by default, but non-standard ports are supported</li> <li>Available since v4.40.0</li></ul></li> <li>DNS over <strong>HTTPS</strong>: The query is routed to a configuration-specified outbound
<ul><li>In the form of <code>https://host:port/dns-query</code>, such as <code>https://dns.google/dns-query</code> or <code>https://1.1.1.1/dns-query</code></li> <li>The query is made on port <code>443</code> by default, but non-standard ports and links are supported, such as <code>https://a.b.c.d:8443/my-dns-query</code></li> <li>Available since v4.22.0</li></ul></li> <li>DNS over <strong>HTTPS local mode</strong>: The query is not rerouted, but instead directly forwarded through a <code>freedom</code> outbound
<ul><li>In the form of <code>https+local://host:port/dns-query</code>, such as <code>https+local://223.5.5.5/dns-query</code></li> <li>The query is made on port <code>443</code> by default, but non-standard ports and links are supported, such as <code>https+local://a.b.c.d:8443/my-dns-query</code></li> <li>Available since v4.22.0</li></ul></li> <li>DNS over <strong>QUIC local mode</strong>: The query is not rerouted, but instead directly forwarded through a <code>freedom</code> outbound
<ul><li>In the form of <code>quic+local://host</code>, such as <code>quic+local://dns.adguard.com</code></li> <li>The query is made on port <code>784</code> by default, but non-standard ports are supported</li> <li>As of September 20, 2021, public recursive DNS services that support the DNS over QUIC protocol include <code>dns.adguard.com</code> and <code>dns.nextdns.io</code> (in addition to port 784, queries can also be made on port 8853)</li> <li>Available since v4.34.0</li></ul></li> <li>Special Options:
<ul><li><strong>localhost</strong>: Uses the DNS configuration of the server's operating system</li> <li><strong>FakeDNS</strong>: Uses the built-in FakeDNS server in V2Ray. For details, see <a href="/en_US/config/fakedns.html">FakeDNS server</a>. Available since v4.35.0</li></ul></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>When using <code>localhost</code>, the DNS requests on the local machine are not controlled by V2Ray. Additional configuration is required to forward DNS requests with V2Ray.</p></div> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>If you are using DNS over QUIC on a Linux device, you may need to adjust the receive buffer size. The following command sets it to 2.5 MB.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ sysctl -w net.core.rmem_max<span class="token operator">=</span><span class="token number">2500000</span>
</code></pre></div><p>Reference: <a href="https://github.com/lucas-clemente/quic-go/wiki/UDP-Receive-Buffer-Size" target="_blank" rel="noopener noreferrer">https://github.com/lucas-clemente/quic-go/wiki/UDP-Receive-Buffer-Size<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <h2 id="dns-processing-flow"><a href="#dns-processing-flow" class="header-anchor">#</a> DNS Processing Flow</h2> <p>If the domain name currently being queried...</p> <ul><li>Hits a &quot;domain name - IP&quot; or &quot;domain name - IP array&quot; mapping in the <code>hosts</code> file, the IP or IP array will be returned as the DNS resolution result.</li> <li>Hits a &quot;domain name - domain name&quot; mapping in the <code>hosts</code> file, the value of the mapping (another domain name) will be used as the new domain name currently being queried, and enter the DNS processing flow until the IP is resolved and returned, or an empty resolution is returned.</li> <li>Does not hit the <code>hosts</code> file, but hits the domain name list <code>domains</code> in one or more DNS servers, the DNS server corresponding to the rule with the highest priority will be queried sequentially according to the hit rule. If the query fails or the <code>expectIPs</code> do not match, the next DNS server will be queried; otherwise, the resolved IP will be returned. If all the DNS servers fail, the DNS component will:
<ul><li>By default, perform a &quot;DNS fallback query&quot;: Use a DNS server which was not queried in the previous failure which has a <code>skipFallback</code> value of <code>false</code>. If this query fails too, or if the <code>expectIPs</code> do not match, an empty resolution will be returned; otherwise, the resolved IP will be returned.</li> <li>If <code>disableFallback</code> is set to <code>true</code>, no &quot;DNS fallback query&quot; will be performed.</li></ul></li> <li>Hits neither the <code>hosts</code> file nor the domain name list <code>domains</code> in the DNS server, then:
<ul><li>By default, use the &quot;DNS server with <code>skipFallback</code> set to the default value <code>false</code>&quot; to query sequentially. If the first DNS server selected fails or the <code>expectIPs</code> do not match, the next selected DNS server will be queried; otherwise, the resolved IP will be returned. If all selected DNS servers fail, an empty resolution will be returned.</li> <li>If there are no DNS servers with <code>skipFallback</code> set to the default value <code>false</code>&quot;, or if <code>disableFallback</code> is set to <code>true</code>, the first DNS server in the DNS configuration will be used for the query. If the query fails or does not match the <code>expectIPs</code> list, an empty resolution will be returned; otherwise, the resolved IP will be returned.</li></ul></li></ul> <p>The DNS processing flowchart is as follows:</p> <p><img src="/dns_flowchart_20210418.svg" alt="DNS resolution process"></p> <h2 id="dnsobject"><a href="#dnsobject" class="header-anchor">#</a> DnsObject</h2> <p><code>DnsObject</code> corresponds to the <code>dns</code> parameter of the configuration file.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;hosts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;baidu.com&quot;</span><span class="token operator">:</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;example.com&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;::1&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;proxy.example.com&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;127.0.0.2&quot;</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;dns.google&quot;</span><span class="token operator">:</span> <span class="token string">&quot;8.8.8.8&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;proxy.example.com&quot;</span><span class="token operator">:</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;geosite:test&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;another-proxy.example.com&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;127.0.0.1&quot;</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;geosite:category-ads-all&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;127.0.0.2&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;::1&quot;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;servers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;https://dns.google/dns-query&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;223.5.5.5&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">5353</span><span class="token punctuation">,</span>
            <span class="token property">&quot;clientIp&quot;</span><span class="token operator">:</span> <span class="token string">&quot;5.6.7.8&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;skipFallback&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token property">&quot;domains&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">&quot;domain:baidu.com&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;geosite:cn&quot;</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;expectIPs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">&quot;geoip:cn&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;ext:customizedGeoIPFile.dat:cn&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;ext-ip:customizedGeoIPFile.dat:cn&quot;</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;fakedns&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;domains&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">&quot;domain:v2fly.org&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;geosite:geolocation-!cn&quot;</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://1.1.1.1/dns-query&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;domains&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">&quot;domain:v2fly.org&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;geosite:geolocation-!cn&quot;</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;expectIPs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">&quot;geoip:!cn&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;ext:customizedGeoIPFile.dat:!cn&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;ext-ip:customizedGeoIPFile.dat:!cn&quot;</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;1.0.0.1&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;localhost&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;clientIp&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.2.3.4&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;queryStrategy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;UseIPv4&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;disableCache&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;disableFallback&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dns_inbound&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><code>hosts</code>: map{string: address} | map{string: [address]}</p></blockquote> <p>Lists configured hosts mappings. Supports mapping a domain to an address one-to-one, or mapping a domain to several addresses in an array (v4.37.3+), where the address can be IP or another domain name.</p> <p>When parsing a domain name, and the domain name matches an item in this list of mappings, if the address of this item is an IP, the returned result is the IP of this item, and no subsequent DNS parsing will be performed; if the address of this item is a domain name, the domain name will be used for subsequent DNS parsing, superseding the original domain name.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>If multiple IPs and domain names are set for the same address at the same time, only the first one will be returned, and the remaining IPs and domain names will be ignored.</p></div> <p>The format of the domain name has the following forms:</p> <ul><li><strong>String</strong>: This pattern takes effect when this domain name completely matches the target domain name. For example, <code>v2ray.com</code> matches <code>v2ray.com</code> but not <code>www.v2ray.com</code>.</li> <li><strong>Regular Expression</strong>: Starts with <code>regexp:</code>, followed by a regular expression. This pattern takes effect when this regular expression matches the target domain name. For example, <code>regexp:\.goo.*\.com$</code> matches <code>www.google.com</code>, <code>fonts.googleapis.com</code>, but not <code>google.com</code>.</li> <li><strong>Subdomain (recommended)</strong>: Starts with <code>domain:</code>, followed by a domain name. This pattern takes effect when this domain name is the target domain name or its subdomain. For example, <code>domain:v2ray.com</code> matches <code>www.v2ray.com</code>, <code>v2ray.com</code>, but not <code>xv2ray.com</code>.</li> <li><strong>Substring</strong>: Starts with <code>keyword:</code>, followed by a string. This pattern takes effect when this string matches any part of the target domain name. For example, <code>keyword:sina.com</code> can match <code>sina.com</code>, <code>sina.com.cn</code>, <code>www.sina.com</code> and <code>www.sina.company</code>, but not <code>sina.cn</code>.</li> <li><strong>Predefined domain name list</strong>: Starts with <code>geosite:</code>, followed by a name, such as <code>geosite:google</code> or <code>geosite:cn</code>. For a list of names and domain names, see <a href="/en_US/config/routing.html#TODO">Predefined Domain Name List</a>.</li></ul> <blockquote><p><code>servers</code>: [string | <a href="#serverobject">ServerObject</a> ]</p></blockquote> <p>List of DNS servers to use. Two forms are accepted: direct DNS server address (string) and <a href="#serverobject">ServerObject</a>.</p> <p>For details, see [Supported DNS Protocols and Routing Policies](#Supported-DNS protocols and routing strategies)</p> <blockquote><p><code>clientIp</code>: string</p></blockquote> <p>The IP address of the current network. Used to notify the DNS server of the client's geographical location when querying. (cannot be a private IP address)</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>This feature requires the DNS server to support EDNS Client Subnet (RFC7871).</p></div> <blockquote><p><code>queryStrategy</code>: &quot;UseIP&quot; | &quot;UseIPv4&quot; | &quot;UseIPv6&quot;</p></blockquote> <p>(Since v4.37.0) The Internet Protocol version used for DNS queries. The default value is <code>UseIP</code>, which means that DNS queries for both A and AAAA records of the domain name at the same time. <code>UseIPv4</code> and <code>UseIPv6</code> will query only the A record or the AAAA record, respectively.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>It is recommended that users who do not have IPv6 access to use <code>UseIPv4</code>. This option has the same priority as the <code>domainStrategy</code> option in the <code>outbound</code> of the <code>freedom</code> protocol. It is recommended to set <code>domainStrategy</code> at the same time.</p></div> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>If this is set to <code>UseIPv4</code>, but the <code>domainStrategy</code> option in the <code>outbound</code> of the <code>freedom</code> protocol is set to <code>UseIPv6</code>, it will cause DNS queries from <code>freedom</code> protocol <code>outbound</code> to be intercepted by the Go runtime, which will then cause DNS leakage; same for the reverse.</p></div> <blockquote><p><code>disableCache</code>: bool</p></blockquote> <p>(Since v4.35.0) Disables DNS caching. The default is false (DNS cache enabled).</p> <blockquote><p><code>disableFallback</code>: bool</p></blockquote> <p>(Since v4.37.2) Disables DNS fallback queries. The default is false (DNS fallback enabled). For details, see [DNS Processing Flow](#DNS Processing Flow).</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>If this option is set to <code>true</code>, the <code>skipFallback</code> in <a href="#ServerObject">ServerObject</a> will not take effect.</p></div> <blockquote><p><code>disableFallbackIfMatch</code>: bool</p></blockquote> <p>(Since v4.40.2) Disables DNS fallback queries when a priority matching domain name list in the DNS server is hit.</p> <blockquote><p><code>tag</code>: string</p></blockquote> <p>(Since v4.13) All query traffic sent by this DNS, except for <code>localhost</code> and <code>DOHL_</code> mode, will be tagged with this tag, which can be matched by <code>inboundTag</code> in routing.</p> <h2 id="serverobject"><a href="#serverobject" class="header-anchor">#</a> ServerObject</h2> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;223.5.5.5&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">5353</span><span class="token punctuation">,</span>
    <span class="token property">&quot;clientIp&quot;</span><span class="token operator">:</span> <span class="token string">&quot;5.6.7.8&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;skipFallback&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;domains&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;domain:baidu.com&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;geosite:cn&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;expectIPs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;geoip:cn&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;ext:customizedGeoIPFile.dat:cn&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;ext-ip:customizedGeoIPFile.dat:cn&quot;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><code>address</code>: string</p></blockquote> <p>The DNS server address, such as <code>8.8.8.8</code>, <code>tcp+local://8.8.8.8:53</code>, or <code>https://dns.google/dns-query</code>. See <a href="#Supported-DNS-protocols-and-routing-strategies">Supported DNS Protocols and Routing Strategies</a> for details.</p> <blockquote><p><code>port</code>: number</p></blockquote> <p>The DNS server port, by default <code>53</code>. It is ignored when DOH, DOHL, or DOQL mode is used; In those cases non-standard ports should be specified in the URL.</p> <blockquote><p><code>clientIp</code>: string</p></blockquote> <p>The IP address of the current network. Used to notify the DNS server of the client's geographical location when querying. (cannot be a private IP address) The priority of <code>clientIp</code> here is higher than that of the outer configuration of <code>clientIp</code>, which can be used to obtain the same domain name resolution result in different regions from the same DNS server using a different <code>clientIp</code>. (4.34.0+)</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>This feature requires the DNS server to support EDNS Client Subnet (RFC7871).</p></div> <blockquote><p><code>skipFallback</code>: bool</p></blockquote> <p>(Since v4.37.2) Whether to skip this DNS during DNS fallback queries. The default is false (DNS fallback enabled). See <a href="#DNS-Processing-Flow">DNS Processing Flow</a> for details.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>This option can be used to prevent DNS leaks during DNS fallback queries for <code>A</code> and <code>AAAA</code> records.</p></div> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>If <code>disableFallback</code> in <a href="#dnsobject">DnsObject</a> is set to <code>true</code>, this option will be ignored.</p></div> <blockquote><p><code>domains</code>: [string]</p></blockquote> <p>A list of domain names. Queries for domain names in this list will prioritize using this server. The domain name format is the same as that in <a href="/en_US/config/routing.html#RuleObject">Routing Configuration</a>.</p> <blockquote><p><code>expectIPs</code>:[string]</p></blockquote> <p>(Since v4.22.0) A list of IP ranges, with the same format as <a href="/en_US/config/routing.html#RuleObject">Routing Configuration</a>.</p> <p>When this item is configured, V2Ray's DNS module will verify that the returned IP is within the specified range, and only return the address that meets the expectIPs list. If this item is not configured, the IP address will be returned as-is.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/v2fly/v2fly-github-io/edit/master/docs/en_US/config/dns.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/15/2022, 8:25:54 PM</span></div></footer> <div class="contributors" style="display:none;" data-v-6000aab7><span data-v-6000aab7>Contributors</span> </div> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/en_US/config/overview.html" class="prev">
        Configuration File Format
      </a></span> <span class="next"><a href="/en_US/config/outbounds.html">
        Outbounds
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.53fc3f09.js" defer></script><script src="/assets/js/3.21417aa6.js" defer></script><script src="/assets/js/6.86334a57.js" defer></script><script src="/assets/js/56.e7d5cf5c.js" defer></script>
  </body>
</html>
