import{_ as n,o as s,c as a,e}from"./app.1e1d5899.js";const o={},t=e(`<h1 id="multiple-configuration-files" tabindex="-1"><a class="header-anchor" href="#multiple-configuration-files" aria-hidden="true">#</a> Multiple configuration files</h1><p>Starting from v4.23.0, V2Ray supports loading multiple configuration files.</p><p>The main purpose of utilizing multiple configuration files is to distribute the configuration of many different isolated modules for easier management and maintenance. This function is primarily designed to enrich the V2Ray ecosystem, such as for GUI interfaces, which generally only implement fixed functions such as inbound/outbound selection, and may have trouble interpreting and/or generating complex configurations. Now, only one <code>confdir</code> custom configuration directory is required to configure complex functions; for server deployment scripts, just add additional configurations to the <code>confdir</code> to configure many different protocols and modules with ease.</p><h2 id="example-multiple-startup-configurations" tabindex="-1"><a class="header-anchor" href="#example-multiple-startup-configurations" aria-hidden="true">#</a> Example: Multiple startup configurations</h2><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>The startup information will prompt for each configuration file read in turn, pay attention to whether the startup information is in the order you preset.</p></div><p><code>$ v2ray -c v2ray.json -c 00_base.json -c 01_info.json -c 02_log.json -c outbound.json</code></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>V2Ray v4.23.0-version (user) 20200311-000000 (go1.13.8 linux/mipsle)
A unified platform for anti-censorship.
2020/03/22 18:40:00 [Info] v2ray.com/core/common/platform/ctlcmd: &lt;v2ctl message&gt;
v2ctl&gt; Read config:  00_base.json
v2ctl&gt; Read config:  01_info.json
v2ctl&gt; Read config:  02_log.json
v2ctl&gt; Read config:  outbound.json
v2ctl&gt; [ outbound.json ] updated outbound with tag:  proxy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="usage" tabindex="-1"><a class="header-anchor" href="#usage" aria-hidden="true">#</a> Usage</h2><p>The command line argument <code>-c</code> or <code>-config</code> can be specified multiple times.</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>v2ray <span class="token parameter variable">-config</span> base.json <span class="token parameter variable">-config</span> cf1.json <span class="token parameter variable">-c</span> cf2.json <span class="token parameter variable">-c</span> cf3.json
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Alternatively, the <code>-confdir</code> parameter can specify a directory, from which V2Ray will read <code>.json</code> configuration files in the specified directory, in order of filenames.</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>v2ray <span class="token parameter variable">-confdir</span> /etc/v2ray/confs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Both can be used simultaneously. (<code>-c</code> and <code>-config</code> configurations will always be loaded before <code>-confdir</code> configurations.)</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>v2ray <span class="token parameter variable">-c</span> cf1.json <span class="token parameter variable">-c</span> cf2.json <span class="token parameter variable">-confdir</span> /etc/v2ray/confs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>You can also use the [environment variables](env.md#Directory for multiple configurations) <code>v2ray.location.confdir</code>, or <code>V2RAY_LOCATION_CONFDIR</code> to specify <code>confdir</code>. (The <code>-confdir</code> parameter takes precedence over the environment variable; if it specifies a valid directory, the path in the environment variable is not read.)</p><h2 id="parameters" tabindex="-1"><a class="header-anchor" href="#parameters" aria-hidden="true">#</a> Parameters</h2><h4 id="objects" tabindex="-1"><a class="header-anchor" href="#objects" aria-hidden="true">#</a> Objects (<code>{}</code>)</h4><p><strong>For all objects nested within the top-level object of the JSON configuration, parameters loaded first will be either superseded or supplemented (depending on type) by parameters loaded after it.</strong></p><p>Example:</p><ul><li>base.json</li></ul><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;log&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;api&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dns&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;stats&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;policy&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;transport&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;routing&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;inbounds&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>outbounds.json</li></ul><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;outbounds&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Start V2Ray with both configurations:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>v2ray <span class="token parameter variable">-c</span> base.json <span class="token parameter variable">-c</span> outbounds.json
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>These two configuration files are equivalent to a single merged configuration file. When you need to modify the outbound node, you only need to modify the content of <code>outbounds.json</code>.</p><p>As an additional example, if you need to change the log level specified by <code>log</code>, you don&#39;t need to modify <code>base.json</code>, you only need to add an additional configuration to be loaded last:</p><ul><li>debuglog.json</li></ul><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;log&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;loglevel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;debug&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Start V2Ray while placing it after <code>base.json</code>:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>v2ray <span class="token parameter variable">-c</span> base.json <span class="token parameter variable">-c</span> outbounds.json <span class="token parameter variable">-c</span> debuglog.json
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="arrays" tabindex="-1"><a class="header-anchor" href="#arrays" aria-hidden="true">#</a> Arrays (<code>[]</code>)</h4><p>In the JSON configuration, the parameters <code>inbounds</code> and <code>outbounds</code> are array structures. These array specifically have special rules during merging:</p><ul><li>If more than one of each is present, the very last array supersedes all other previous arrays.</li><li>If there is only one present, V2Ray first attempts to find any existing configurations specified in the with the same <code>tag</code> to override by order (as specified before). Then: <ul><li>For inbound elements, appends it to the end of all inbounds (order is irrelevant)</li><li>For outbound elements, prepends it to the front of all outbounds (the first outbound is the preferred one in case of conflict); but if the filename contains <code>tail</code> (case insensitive), appends it to the end.</li></ul></li></ul><p>With multiple configurations, you can easily add inbound of different protocols to the original configuration file without modifying it directly.</p><p>The following example is not a valid configuration, but only an example to demonstrate those rules:</p><ul><li>000.json</li></ul><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;inbounds&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;socks&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span><span class="token string">&quot;socks&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">1234</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>001.json</li></ul><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;inbounds&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span><span class="token string">&quot;http&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>002.json</li></ul><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;inbounds&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;socks&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span><span class="token string">&quot;socks&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">4321</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The three configurations will be merged into:</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;inbounds&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;socks&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span><span class="token string">&quot;socks&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">4321</span> <span class="token comment">// &lt;--- 002 is loaded after 000, thus the port of the duplicate &quot;socks&quot; configuration is overwritten as &quot;4321&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span><span class="token string">&quot;http&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="recommended-multi-config-list" tabindex="-1"><a class="header-anchor" href="#recommended-multi-config-list" aria-hidden="true">#</a> Recommended multi-config list</h2><p>Execute:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token keyword">for</span> <span class="token for-or-select variable">BASE</span> <span class="token keyword">in</span> 00_log 01_api 02_dns 03_routing 04_policy 05_inbounds 06_outbounds 07_transport 08_stats 09_reverse<span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token builtin class-name">echo</span> <span class="token string">&#39;{}&#39;</span> <span class="token operator">&gt;</span> <span class="token string">&quot;/etc/v2ray/<span class="token variable">$BASE</span>.json&quot;</span><span class="token punctuation">;</span> <span class="token keyword">done</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Or,</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token keyword">for</span> <span class="token for-or-select variable">BASE</span> <span class="token keyword">in</span> 00_log 01_api 02_dns 03_routing 04_policy 05_inbounds 06_outbounds 07_transport 08_stats 09_reverse<span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token builtin class-name">echo</span> <span class="token string">&#39;{}&#39;</span> <span class="token operator">&gt;</span> <span class="token string">&quot;/usr/local/etc/v2ray/<span class="token variable">$BASE</span>.json&quot;</span><span class="token punctuation">;</span> <span class="token keyword">done</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">.</span>
\u251C\u2500\u2500 00_log.json
\u251C\u2500\u2500 01_api.json
\u251C\u2500\u2500 02_dns.json
\u251C\u2500\u2500 03_routing.json
\u251C\u2500\u2500 04_policy.json
\u251C\u2500\u2500 05_inbounds.json
\u251C\u2500\u2500 06_outbounds.json
\u251C\u2500\u2500 07_transport.json
\u251C\u2500\u2500 08_stats.json
\u2514\u2500\u2500 09_reverse.json

<span class="token number">0</span> directories, <span class="token number">10</span> files
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,50),i=[t];function p(l,c){return s(),a("div",null,i)}const u=n(o,[["render",p],["__file","multiple_config.html.vue"]]);export{u as default};
