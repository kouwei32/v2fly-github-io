import{_ as p,r,o as l,c as i,a,b as n,w as t,d as e,e as o}from"./app.31d0518d.js";const c={},d=a("h1",{id:"dokodemo-door",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#dokodemo-door","aria-hidden":"true"},"#"),e(" Dokodemo-door")],-1),u=a("ul",null,[a("li",null,[e("Name: "),a("code",null,"dokodemo-door")]),a("li",null,"Type: Inbound Protocol")],-1),b=a("p",null,"Dokodemo Door is an inbound protocol. It binds to a port and send all data entering this port to a designated address, effectively achieving inbound port forwarding / port mapping.",-1),m={class:"custom-container tip"},v=a("p",{class:"custom-container-title"},"TIP",-1),k=e("To reroute outbound traffic as well, combine Dokodemo Door with a "),h=e("Loopback"),_=e(" inbound."),f=o(`<h2 id="inboundconfigurationobject" tabindex="-1"><a class="header-anchor" href="#inboundconfigurationobject" aria-hidden="true">#</a> InboundConfigurationObject</h2><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;8.8.8.8&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">53</span><span class="token punctuation">,</span>
    <span class="token property">&quot;network&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tcp&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;timeout&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;followRedirect&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">&quot;userLevel&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><code>address</code>: string</p></blockquote><p>Forwards traffic to this target address. Can be an IPv4 or IPv6 address (such as <code>&quot;1.1.1.1&quot;</code>) or a domain name (such as <code>&quot;v2ray.com&quot;</code>).</p><p>If <code>followRedirect</code> is enabled, <code>address</code> can be omitted.</p><blockquote><p><code>port</code>: number</p></blockquote><p>Forwards traffic using the specified port. Required.</p><blockquote><p><code>network</code>: &quot;tcp&quot; | &quot;udp&quot; | &quot;tcp,udp&quot;</p></blockquote><p>Limits the types of inbound traffic which can be received. The unselected protocol will be rejected. The default value is <code>&quot;tcp&quot;</code>.</p><blockquote><p><code>timeout</code>: number</p></blockquote><p>The timeout for inbound requests in seconds. The default value is 300.</p><p>Since v3.1, this is equivalent to the <code>connIdle</code> strategy, corresponding to the User Level.</p><blockquote><p><code>followRedirect</code>: true | false</p></blockquote>`,13),R=e("When enabled, Dokodemo Door will recognize any destinations specified by "),q=a("code",null,"iptables",-1),g=e(", and forward it to the corresponding mapped address. For details, see the "),A=a("code",null,"tproxy",-1),y=e(" setting in "),T=e("Transport Configuration"),j=e("."),V=a("blockquote",null,[a("p",null,[a("code",null,"userLevel"),e(": number")])],-1),w=e("User Level. All inbound connections will use this User Level. See "),x=e("Local Policy"),U=e("."),N=o(`<h2 id="example-transparent-proxy" tabindex="-1"><a class="header-anchor" href="#example-transparent-proxy" aria-hidden="true">#</a> Example: Transparent proxy</h2><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;network&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tcp,udp&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;timeout&quot;</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
    <span class="token property">&quot;followRedirect&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Configure <code>iptables</code>:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># Create new chain</span>
iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-N</span> V2RAY
iptables <span class="token parameter variable">-t</span> mangle <span class="token parameter variable">-N</span> V2RAY
iptables <span class="token parameter variable">-t</span> mangle <span class="token parameter variable">-N</span> V2RAY_MARK

<span class="token comment"># Ignore your V2Ray server&#39;s addresses</span>
<span class="token comment"># This is VERY IMPORTANT, be careful!</span>
iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-A</span> V2RAY <span class="token parameter variable">-d</span> <span class="token number">123.123</span>.123.123 <span class="token parameter variable">-j</span> RETURN

<span class="token comment"># Ignore LANs and any other addresses you&#39;d like to bypass the proxy</span>
<span class="token comment"># See Wikipedia and RFC5735 for full list of reserved networks.</span>
iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-A</span> V2RAY <span class="token parameter variable">-d</span> <span class="token number">0.0</span>.0.0/8 <span class="token parameter variable">-j</span> RETURN
iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-A</span> V2RAY <span class="token parameter variable">-d</span> <span class="token number">10.0</span>.0.0/8 <span class="token parameter variable">-j</span> RETURN
iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-A</span> V2RAY <span class="token parameter variable">-d</span> <span class="token number">127.0</span>.0.0/8 <span class="token parameter variable">-j</span> RETURN
iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-A</span> V2RAY <span class="token parameter variable">-d</span> <span class="token number">169.254</span>.0.0/16 <span class="token parameter variable">-j</span> RETURN
iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-A</span> V2RAY <span class="token parameter variable">-d</span> <span class="token number">172.16</span>.0.0/12 <span class="token parameter variable">-j</span> RETURN
iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-A</span> V2RAY <span class="token parameter variable">-d</span> <span class="token number">192.168</span>.0.0/16 <span class="token parameter variable">-j</span> RETURN
iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-A</span> V2RAY <span class="token parameter variable">-d</span> <span class="token number">224.0</span>.0.0/4 <span class="token parameter variable">-j</span> RETURN
iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-A</span> V2RAY <span class="token parameter variable">-d</span> <span class="token number">240.0</span>.0.0/4 <span class="token parameter variable">-j</span> RETURN

<span class="token comment"># Anything else should be redirected to Dokodemo-door&#39;s local port</span>
iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-A</span> V2RAY <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">-j</span> REDIRECT --to-ports <span class="token number">12345</span>

<span class="token comment"># Add any UDP rules</span>
<span class="token function">ip</span> route <span class="token function">add</span> <span class="token builtin class-name">local</span> default dev lo table <span class="token number">100</span>
<span class="token function">ip</span> rule <span class="token function">add</span> fwmark <span class="token number">1</span> lookup <span class="token number">100</span>
iptables <span class="token parameter variable">-t</span> mangle <span class="token parameter variable">-A</span> V2RAY <span class="token parameter variable">-p</span> udp <span class="token parameter variable">--dport</span> <span class="token number">53</span> <span class="token parameter variable">-j</span> TPROXY --on-port <span class="token number">12345</span> --tproxy-mark 0x01/0x01
iptables <span class="token parameter variable">-t</span> mangle <span class="token parameter variable">-A</span> V2RAY_MARK <span class="token parameter variable">-p</span> udp <span class="token parameter variable">--dport</span> <span class="token number">53</span> <span class="token parameter variable">-j</span> MARK --set-mark <span class="token number">1</span>

<span class="token comment"># Apply rules</span>
iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-A</span> OUTPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">-j</span> V2RAY
iptables <span class="token parameter variable">-t</span> mangle <span class="token parameter variable">-A</span> PREROUTING <span class="token parameter variable">-j</span> V2RAY
iptables <span class="token parameter variable">-t</span> mangle <span class="token parameter variable">-A</span> OUTPUT <span class="token parameter variable">-j</span> V2RAY_MARK
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4);function Y(E,I){const s=r("RouterLink");return l(),i("div",null,[d,u,b,a("div",m,[v,a("p",null,[k,n(s,{to:"/en_US/config/protocols/loopback.html"},{default:t(()=>[h]),_:1}),_])]),f,a("p",null,[R,q,g,A,y,n(s,{to:"/en_US/config/transport.html"},{default:t(()=>[T]),_:1}),j]),V,a("p",null,[w,n(s,{to:"/en_US/config/policy.html"},{default:t(()=>[x]),_:1}),U]),N])}const P=p(c,[["render",Y],["__file","dokodemo.html.vue"]]);export{P as default};
